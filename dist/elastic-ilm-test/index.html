<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/thumbnails/favicon.png"><meta name="generator" content="Astro v4.16.19"><title>Test driving Elasticsearch Index Lifecycle Management with Data streams - Aravind Putrevu</title><meta name="description" content="Test driving Elasticsearch Index Lifecycle Management with Data streams"><link rel="sitemap" href="/sitemap-index.xml"><!-- Open Graph / Social Media --><meta property="og:title" content="Test driving Elasticsearch Index Lifecycle Management with Data streams - Aravind Putrevu"><meta property="og:description" content="Test driving Elasticsearch Index Lifecycle Management with Data streams"><meta property="og:type" content="website"><!-- Twitter Card --><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@aravindputrevu"><meta name="twitter:title" content="Test driving Elasticsearch Index Lifecycle Management with Data streams - Aravind Putrevu"><meta name="twitter:description" content="Test driving Elasticsearch Index Lifecycle Management with Data streams"><link rel="stylesheet" href="/_astro/_slug_.DRsGrASp.css">
<style>.article-header[data-astro-cid-fzx4jmue]{margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #eee}.article-header[data-astro-cid-fzx4jmue] h1[data-astro-cid-fzx4jmue]{margin-bottom:.5rem}.article-header[data-astro-cid-fzx4jmue] time[data-astro-cid-fzx4jmue]{color:#666;font-size:.9rem}.tags[data-astro-cid-fzx4jmue]{display:flex;gap:.5rem;margin-top:1rem;flex-wrap:wrap}.tag[data-astro-cid-fzx4jmue]{background:#f0f0f0;padding:.25rem .75rem;border-radius:3px;font-size:.85rem}.post-content[data-astro-cid-fzx4jmue]{line-height:1.8}
</style><script type="module">const d=localStorage.getItem("theme");d==="dark"&&document.documentElement.classList.add("dark");const e=document.getElementById("dark-mode-button"),o=localStorage.getItem("theme");o==="dark"&&(document.documentElement.classList.add("dark"),e&&(e.textContent="‚óã"));e?.addEventListener("click",()=>{if(document.documentElement.classList.contains("dark"))document.documentElement.classList.remove("dark"),localStorage.removeItem("theme"),document.querySelector("#dark-mode")?.remove(),e.textContent="‚óè";else{document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark"),e.textContent="‚óã";const n=document.getElementsByTagName("head")[0],t=document.createElement("link");t.rel="stylesheet",t.id="dark-mode",t.href="/dark.css",n.appendChild(t)}});
</script></head> <body> <nav class="navbar" data-astro-cid-eqd27vgs> <div class="container" data-astro-cid-eqd27vgs> <div class="flex" data-astro-cid-eqd27vgs> <div data-astro-cid-eqd27vgs> <a href="/" class="brand" data-astro-cid-eqd27vgs>
Aravind Putrevu
</a> </div> <div class="flex nav-links" data-astro-cid-eqd27vgs> <a href="/blog" data-astro-cid-eqd27vgs>Writing</a> <a href="/archive" data-astro-cid-eqd27vgs>Archive</a> <a href="/about" data-astro-cid-eqd27vgs>About</a> <button id="dark-mode-button" aria-label="Toggle dark mode" data-astro-cid-eqd27vgs>‚óè</button> </div> </div> </div> </nav>   <main>  <article class="container" data-astro-cid-fzx4jmue> <header class="article-header" data-astro-cid-fzx4jmue> <h1 data-astro-cid-fzx4jmue>Test driving Elasticsearch Index Lifecycle Management with Data streams</h1> <time data-astro-cid-fzx4jmue>April 11, 2021</time> <div class="tags" data-astro-cid-fzx4jmue> <span class="tag" data-astro-cid-fzx4jmue>elasticsearch</span><span class="tag" data-astro-cid-fzx4jmue>observability</span><span class="tag" data-astro-cid-fzx4jmue>cloud</span><span class="tag" data-astro-cid-fzx4jmue>tech</span> </div> </header> <div class="post-content" data-astro-cid-fzx4jmue> <p>Everything in Elasticsearch goes to an Index. The data, settings of various Kibana dashboards, monitoring information of Elasticsearch cluster.</p>
<p>An Index plays a vital role, and duly there is a specific need for managing the data stored in an Index. Index Lifecycle Management has released a beta feature in Elasticsearch 6.6, later GA‚Äôed in 6.7.</p>
<p>There were projects like <a href="https://github.com/elastic/curator">Curator</a> used to do the data management part for Elasticsearch. It gained fame in less time. Curator is not maintained anymore.</p>
<blockquote>
<p>Note: Curator is deprecated and not actively maintained anymore.</p>
</blockquote>
<h3 id="index-lifecycle-management">Index Lifecycle Management</h3>
<p>Index Lifecycle Management is like a cron job applied to indices.</p>
<p>Somethings to remember</p>
<ul>
<li>ILM is applied on indices using ILM policies.</li>
<li>ILM policies contain information that takes action on data based on the threshold guidelines mentioned in the policy.</li>
<li>ILM policies contain phases (hot, warm, cold, delete). You can perform specific actions along with the data transition, like reducing the number of primary shards and taking a snapshot.</li>
</ul>
<h3 id="test-driving-ilm">Test driving ILM</h3>
<p><a href="http://elastic.co">Elastic.co</a> has detailed ILM <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-lifecycle-management.html">documentation</a>. In this blog post, we‚Äôll see how ILM works. I want to show how data could be transitioned from one phase (tier: hot) to another (tier: warm).</p>
<h4 id="prerequisites">Prerequisites:</h4>
<ul>
<li>Create a free Elastic Cloud account <a href="https://cloud.elastic.co/registration">here</a>.  Spin up an Observability deployment with a warm tier ‚Üí launch Kibana ‚Üí Head to ‚ÄúDev Tools‚Äù in the left menu. Refer to screenshots <a href="#elastic-cloud-account-creation">here</a>.</li>
<li>We‚Äôll be using Data streams. If you are new to the concept, please refer to <a href="https://aravind.dev/elastic-data-stream/">data streams blog post</a>. Data streams are nothing but Elasticsearch aliases with superpowers with hidden auto-generated indices backing them.</li>
</ul>
<p>Alternatively, you can <a href="https://elastic.co/downloads/elasticsearch">download</a> and build a two-node Elasticsearch cluster with a <code>node.role</code>mapped as <code>data_hot</code> and <code>data_warm</code> and <a href="https://elastic.co/downloads/kibana">spin a Kibana</a> optionally if you want to try the ILM UI.</p>
<h4 id="create-an-ilm-policy">Create an ILM Policy</h4>
<p>I‚Äôm creating an ILM policy named <code>my-ilm-policy</code> with thresholds to rollover the data to the next phase. The policy is configured to move data to the warm phase from the hot phase when the maximum age is set to two minutes OR two kilobytes, OR a maximum number of docs are two per index.</p>
<blockquote>
<p>Note: Phases indicate nodes with different hardware performance capabilities and node attributes marked as <code>data_hot</code>, <code>data_warm</code>, etc.</p>
</blockquote>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT _ilm/policy/my-ilm-policy</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">policy</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">phases</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">hot</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">actions</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">rollover</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#8FBCBB">max_age</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2m</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#8FBCBB">max_size</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2kb</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#8FBCBB">max_docs</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 2</span></span>
<span class="line"><span style="color:#ECEFF4">          },</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">set_priority</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#8FBCBB">priority</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 100</span></span>
<span class="line"><span style="color:#ECEFF4">          }</span></span>
<span class="line"><span style="color:#ECEFF4">        },</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">min_age</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">0ms</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">      },</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">warm</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">min_age</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">0d</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">actions</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">set_priority</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#8FBCBB">priority</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#B48EAD"> 50</span></span>
<span class="line"><span style="color:#ECEFF4">          }</span></span>
<span class="line"><span style="color:#ECEFF4">        }</span></span>
<span class="line"><span style="color:#ECEFF4">      }</span></span>
<span class="line"><span style="color:#ECEFF4">    }</span></span>
<span class="line"><span style="color:#ECEFF4">  }</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h4 id="view-the-ilm-policy">View the ILM policy</h4>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">GET _ilm/policy/my-ilm-policy</span></span>
<span class="line"></span></code></pre>
<h4 id="create-the-index-template">Create the Index Template</h4>
<p>Data stream needs a matching index template to create a data stream and hidden backing indices. Also, even if you apply ILM policy to an index, it is good to do it via an index template.</p>
<p>Below, we create an Index template; notice the ILM policy attached as part of Index settings. You can also see, the <a href="https://aravind.dev/everything-index-elastic/#templates">composable index templates</a> <code>logs-mappings</code> and <code>logs-settings</code>.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT _index_template/my-index-template</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">template</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">settings</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">index</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">lifecycle</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">name</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">my-ilm-policy</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">        }</span></span>
<span class="line"><span style="color:#ECEFF4">      }</span></span>
<span class="line"><span style="color:#ECEFF4">    },</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">mappings</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">dynamic</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> true</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">numeric_detection</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> false</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">date_detection</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> true</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">dynamic_date_formats</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#A3BE8C">strict_date_optional_time</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#A3BE8C">yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">      ],</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">_source</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">enabled</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> true</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">includes</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> [],</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">excludes</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> []</span></span>
<span class="line"><span style="color:#ECEFF4">      },</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">_routing</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">required</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#81A1C1"> false</span></span>
<span class="line"><span style="color:#ECEFF4">      }</span></span>
<span class="line"><span style="color:#ECEFF4">    }</span></span>
<span class="line"><span style="color:#ECEFF4">  },</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">index_patterns</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#A3BE8C">my-index-*</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">  ],</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">data_stream</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {},</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">composed_of</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#A3BE8C">logs-mappings</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#A3BE8C">logs-settings</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">  ]</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h4 id="change-the-poll-interval">Change the poll interval</h4>
<p>By default, ILM checks all indices for every ten(10) minutes and sees if any index meets the criteria according to the ILM policy. To see results quickly, let us reset it to run for every fifteen(15) seconds.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT _cluster/settings</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">transient</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">indices.lifecycle.poll_interval</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">15s</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">  }</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h4 id="create-the-data-stream">Create the data stream</h4>
<p>Below API calls look like creating an index <code>my-index-ilm</code>, but it creates a data stream backed by a hidden auto-generated index.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">POST my-index-ilm/_doc</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">@timestamp</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2021-04-11</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravind</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">message</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">This is ILM Demo </span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">POST my-index-ilm/_doc</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">@timestamp</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2021-01-11</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravind</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">message</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">This is 2nd ILM Demo </span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">POST my-index-ilm/_doc</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">@timestamp</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2021-04-11</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravind</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">message</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">This is 3rd ILM Demo </span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h4 id="list-refresh-the-documents-ingested">List, refresh the documents ingested</h4>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">GET _cat/indices/my-index-ilm?v</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">POST my-index-ilm/_refresh</span></span>
<span class="line"></span></code></pre>
<h4 id="view-documents-ingested">View documents ingested</h4>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">GET my-index-ilm/_search</span></span>
<span class="line"></span></code></pre>
<h4 id="explain-the-ilm-status">Explain the ILM status</h4>
<p>Explain API gives detailed information on actions taken on the index.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">GET my-index-ilm/_ilm/explain</span></span>
<span class="line"></span></code></pre>
<p>For example, executing the above request gives you a response like this.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">indices</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">.ds-my-index-ilm-2021.04.10-000001</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">index</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">.ds-my-index-ilm-2021.04.10-000001</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">managed</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#81A1C1"> true</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">policy</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">my-policy</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">lifecycle_date_millis</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1618076137017</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">age</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">9.7s</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">phase</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">hot</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">phase_time_millis</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1618076137113</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">action</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">rollover</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">action_time_millis</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1618076137249</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">step</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">check-rollover-ready</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">step_time_millis</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1618076137249</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">phase_execution</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">policy</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">my-policy</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">phase_definition</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">min_age</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">0ms</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">actions</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#8FBCBB">rollover</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">              "</span><span style="color:#8FBCBB">max_size</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2kb</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">              "</span><span style="color:#8FBCBB">max_age</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2m</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">              "</span><span style="color:#8FBCBB">max_docs</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 2</span></span>
<span class="line"><span style="color:#ECEFF4">            },</span></span>
<span class="line"><span style="color:#ECEFF4">            "</span><span style="color:#8FBCBB">set_priority</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">              "</span><span style="color:#8FBCBB">priority</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 100</span></span>
<span class="line"><span style="color:#ECEFF4">            }</span></span>
<span class="line"><span style="color:#ECEFF4">          }</span></span>
<span class="line"><span style="color:#ECEFF4">        },</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">version</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">modified_date_in_millis</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1618066566215</span></span>
<span class="line"><span style="color:#ECEFF4">      }</span></span>
<span class="line"><span style="color:#ECEFF4">    }</span></span>
<span class="line"><span style="color:#ECEFF4">  }</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h4 id="check-ilm-roll-over">Check ILM roll over</h4>
<p>We‚Äôve ingested three (3) docs and ran refresh. After fifteen (15) seconds ILM should run and rollover the index to the warm tier from the hot tier. If you don‚Äôt even ingest data, ILM will keep rolling over the active index when it meets the two-minute criteria.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">GET _cat/indices/my-index-*?v</span></span>
<span class="line"></span></code></pre>
<h3 id="how-to-find-where-the-data-has-moved">How to find where the Data has moved?</h3>
<p>I have been talking about hot tier and warm tier, that is, nothing but two nodes designated with <code>data_hot</code> and <code>data_warm</code>; <code>node.role</code> attributes.</p>
<p>If you want to take a detailed look at how and where the indices have moved, please turn on Stack monitoring in Kibana and head over to nodes ‚Üí indices.</p>
<p><img src="/images/post-images/elastic-ilm-test/stack-monitoring.png" alt=""></p>
<p><img src="/images/post-images/elastic-ilm-test/ilm-indices-nodes.png" alt=""></p>
<p>If you need more help with ILM or have questions, please write a comment below or DM me on <a href="https://twitter.com/aravindputrevu">Twitter</a>, <a href="https://linkedin.com/in/aravindputrevu">Linkedin</a>. Follow me on Twitter for more exciting updates!</p>
<h3 id="elastic-cloud-account-creation">Elastic Cloud Account creation</h3>
<p>Sign up with your Google, MSFT or any email:</p>
<p><img src="/images/post-images/elastic-ilm-test/ess-login-page.png" alt="Elastic Login Page"></p>
<p>Choose Observability üìä</p>
<p><img src="/images/post-images/elastic-ilm-test/ess-observability.png" alt="Elastic Observability"></p>
<p>Click on Customize after choosing the region and cloud provider of your choice.</p>
<p><img src="/images/post-images/elastic-ilm-test/es-customize.png" alt="Elastic Cloud Customize"></p>
<p>Click on ‚ÄúAdd capacity.‚Äù</p>
<p><img src="/images/post-images/elastic-ilm-test/ess-capacity.png" alt="Elastic Cloud Capacity"></p>
<p>Notice the warm data tier that got added</p>
<p><img src="/images/post-images/elastic-ilm-test/ess-warm-tier.png" alt="Elastic Cloud Warm Tier"></p>
<p>Click on ‚ÄúCreate deployment.‚Äù</p>
<p><img src="/images/post-images/elastic-ilm-test/ess-create-deployment.png" alt="Elastic Cloud Create Deployment"></p>
<p>Click on ‚ÄúLaunch‚Äù to authenticate into Kibana.</p>
<p><img src="/images/post-images/elastic-ilm-test/kibana-launch.png" alt="Elastic Cloud Kibana"></p>
<p>Open the left menu ‚Üí Management ‚Üí Click on Dev Tools.</p>
<p><img src="/images/post-images/elastic-ilm-test/kibana-left-menu.png" alt="Elastic Cloud Dev tools"></p> </div> </article>  </main> <footer class="site-footer" data-astro-cid-lejjx2fa> <div class="footer-inner" data-astro-cid-lejjx2fa> <nav class="footer-nav" data-astro-cid-lejjx2fa> <a href="https://linkedin.com/in/aravindputrevu" target="_blank" rel="noopener noreferrer" data-astro-cid-lejjx2fa>LinkedIn</a> <a href="https://aravindputrevu.substack.com" target="_blank" rel="noopener noreferrer" data-astro-cid-lejjx2fa>Substack</a> <a href="https://github.com/aravindputrevu" target="_blank" rel="noopener noreferrer" data-astro-cid-lejjx2fa>GitHub</a> <a href="/archive" data-astro-cid-lejjx2fa>Archive</a> </nav> <span class="updated" data-astro-cid-lejjx2fa>Last updated January 2026</span> </div> </footer>   </body> </html> 