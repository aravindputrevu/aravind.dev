<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/thumbnails/favicon.png"><meta name="generator" content="Astro v4.16.19"><title>A new way to index time-series data into Elasticsearch! - Aravind Putrevu</title><meta name="description" content="A new way to index time-series data into Elasticsearch!"><link rel="sitemap" href="/sitemap-index.xml"><!-- Open Graph / Social Media --><meta property="og:title" content="A new way to index time-series data into Elasticsearch! - Aravind Putrevu"><meta property="og:description" content="A new way to index time-series data into Elasticsearch!"><meta property="og:type" content="website"><!-- Twitter Card --><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@aravindputrevu"><meta name="twitter:title" content="A new way to index time-series data into Elasticsearch! - Aravind Putrevu"><meta name="twitter:description" content="A new way to index time-series data into Elasticsearch!"><link rel="stylesheet" href="/_astro/_slug_.DRsGrASp.css">
<style>.article-header[data-astro-cid-fzx4jmue]{margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #eee}.article-header[data-astro-cid-fzx4jmue] h1[data-astro-cid-fzx4jmue]{margin-bottom:.5rem}.article-header[data-astro-cid-fzx4jmue] time[data-astro-cid-fzx4jmue]{color:#666;font-size:.9rem}.tags[data-astro-cid-fzx4jmue]{display:flex;gap:.5rem;margin-top:1rem;flex-wrap:wrap}.tag[data-astro-cid-fzx4jmue]{background:#f0f0f0;padding:.25rem .75rem;border-radius:3px;font-size:.85rem}.post-content[data-astro-cid-fzx4jmue]{line-height:1.8}
</style><script type="module">const d=localStorage.getItem("theme");d==="dark"&&document.documentElement.classList.add("dark");const e=document.getElementById("dark-mode-button"),o=localStorage.getItem("theme");o==="dark"&&(document.documentElement.classList.add("dark"),e&&(e.textContent="‚óã"));e?.addEventListener("click",()=>{if(document.documentElement.classList.contains("dark"))document.documentElement.classList.remove("dark"),localStorage.removeItem("theme"),document.querySelector("#dark-mode")?.remove(),e.textContent="‚óè";else{document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark"),e.textContent="‚óã";const n=document.getElementsByTagName("head")[0],t=document.createElement("link");t.rel="stylesheet",t.id="dark-mode",t.href="/dark.css",n.appendChild(t)}});
</script></head> <body> <nav class="navbar" data-astro-cid-eqd27vgs> <div class="container" data-astro-cid-eqd27vgs> <div class="flex" data-astro-cid-eqd27vgs> <div data-astro-cid-eqd27vgs> <a href="/" class="brand" data-astro-cid-eqd27vgs>
Aravind Putrevu
</a> </div> <div class="flex nav-links" data-astro-cid-eqd27vgs> <a href="/blog" data-astro-cid-eqd27vgs>Writing</a> <a href="/archive" data-astro-cid-eqd27vgs>Archive</a> <a href="/about" data-astro-cid-eqd27vgs>About</a> <button id="dark-mode-button" aria-label="Toggle dark mode" data-astro-cid-eqd27vgs>‚óè</button> </div> </div> </div> </nav>   <main>  <article class="container" data-astro-cid-fzx4jmue> <header class="article-header" data-astro-cid-fzx4jmue> <h1 data-astro-cid-fzx4jmue>A new way to index time-series data into Elasticsearch!</h1> <time data-astro-cid-fzx4jmue>April 3, 2021</time> <div class="tags" data-astro-cid-fzx4jmue> <span class="tag" data-astro-cid-fzx4jmue>elasticsearch</span><span class="tag" data-astro-cid-fzx4jmue>data-stream</span><span class="tag" data-astro-cid-fzx4jmue>observability</span><span class="tag" data-astro-cid-fzx4jmue>tech</span> </div> </header> <div class="post-content" data-astro-cid-fzx4jmue> <h2 id="introduction">Introduction</h2>
<p>Elasticsearch, aka ELK stack, is the defacto home for devs doing log analytics for years. Besides, with tools like Metricbeat and APM, Elasticsearch became home for metrics and traces too.</p>
<p>All these different data categories are stored in a simple index that lets you search, correlate and take action. I wrote at length about <a href="https://aravind.dev/everything-index-elastic">Elasticsearch Index</a>, and please refer if you are new to the concept.</p>
<p>Timeseries data is voluminous and snowballs quickly.</p>
<p>For example: For an average user, <code>syslogs</code> from MacBook pro might be anything from the range of 300mb-1Gb per day. Now multiply it with the number of days, it starts to look prominent.</p>
<h3 id="can-i-neglect-and-store-fewer-amounts-of-data">Can I neglect and store fewer amounts of data?</h3>
<p>Well, yes. You can!</p>
<p>But most teams store at least six months of data on Elasticsearch Cluster or even any on other platforms. It could be for various reasons ‚Äî active data engineering work, gathering customer behavior trends, insights, etc.</p>
<blockquote>
<p>Note: You could store data on Cloud Object Stores like S3, GCS, ACS and directly query it from Elasticsearch in a faster manner. This feature is called <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/searchable-snapshots.html">Searchable Snapshots</a>.</p>
</blockquote>
<p>What folks do is time-based indexing, rolling over the data into a newer index based on time or size. If you are using Filebeat to ship logs, the index is rolled over to a new one daily or based on the size threshold by default. Data, when ingested through Filebeat, Filebeat manages the index rotation.</p>
<p>Elasticsearch also has a concept called Aliases, which is a secondary name to an Elasticsearch index. Thereby, in time-series data indexing, you could always use the alias to query the latest data while indices keep rotating daily behind. You always refer to the latest one!</p>
<h3 id="whats-the-problem">What‚Äôs the problem?</h3>
<p>For starters, there are a few.</p>
<ul>
<li>Managing the index rotation.</li>
<li>Setting up the alias.</li>
<li>Querying the data.</li>
</ul>
<p>It might sound like everything I wrote in the previous paragraphs. üòÖ  For beginners looking to get started, they might feel scaling the Elasticsearch cluster data overwhelming with all these concepts.</p>
<h2 id="data-streams">Data streams</h2>
<p>Logs, metrics, traces are time-series data sources that generate in a streaming fashion.</p>
<p>Elasticsearch Data stream is a collection of hidden automatically generated indices that store the streaming logs, metrics, or traces data. It rolls over the index automatically based on the index lifecycle policy conditions that you have set.</p>
<p>Data streams are like aliases with superpowers. The difference is you always write to one index while keep querying on the entire hidden collection of indices.</p>
<p><img src="/images/post-images/everything-index-elastic/es-data-stream.png" alt="ES Data stream"></p>
<h3 id="difference-between-an-index-and-data-stream">Difference between an Index and Data stream</h3>
<p>A Data stream still contains a collection of hidden auto-generated indices. End of the day, data is still stored in Elasticsearch indices.</p>
<h3 id="some-things-to-note">Some things to note:</h3>
<ol>
<li>Every document indexed into the Data stream should have a <code>@timestamp</code> field. Otherwise, it will be added by default.</li>
<li>Every data stream should have a backing index template (I wrote about index templates here.) An index template that is in use by a data stream cannot be deleted.</li>
<li>Cannot add new documents to other read-only indices.</li>
<li>Can update documents in older hidden indices only by update_by_query, delete_by_query.</li>
<li>Cannot perform operations like clone, delete, close, freeze, shrink, split on a write index because these operations could hinder indexing.</li>
</ol>
<h2 id="demonstration-of-data-streams">Demonstration of Data streams</h2>
<p>You need an Elasticsearch cluster to run below commands. You can spin up a cluster for free at <a href="https://cloud.elastic.co/registration?fromURI=%2Fhome">Elastic Cloud</a> OR download the <a href="https://elastic.co/downloads">Elasticsearch and Kibana</a>.</p>
<h3 id="create-a-data-stream">Create a Data stream</h3>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT _data_stream/first-data-stream</span></span>
<span class="line"></span></code></pre>
<p>Executing the above query will give you the below response.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">error</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">root_cause</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">      {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">type</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">illegal_argument_exception</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">reason</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">no matching index template found for data stream [first-data-stream]</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">      }</span></span>
<span class="line"><span style="color:#ECEFF4">    ],</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">type</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">illegal_argument_exception</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">reason</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">no matching index template found for data stream [first-data-stream]</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">  },</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">status</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 400</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<p>But why? As I wrote in the above section, every Data stream needs a matching index template. The current data stream which we intend to create doesn‚Äôt have a matching index template.</p>
<p>Let us create an Index template, beginning with what templates one needs</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT _index_template/my-index-template</span></span>
<span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">index_patterns</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#A3BE8C">my-*-*</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">  ],</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">data_stream</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {},</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">composed_of</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#A3BE8C">logs-mappings</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#A3BE8C">logs-settings</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">  ]</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<p>Now create a Data stream as per the given index pattern.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT _data_stream/my-data-stream</span></span>
<span class="line"></span></code></pre>
<p>Notice that you are creating a data stream via <code>_data_stream</code> API.</p>
<p>Try creating an index with the same name using create index REST API call. You will see the below error as the index template allows to create Data streams only.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT my-data-stream</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">error</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">root_cause</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">      {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">type</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">illegal_argument_exception</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">reason</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">cannot create index with name [my-data-stream], because it matches with template [my-index-template] that creates data streams only, use create data stream api instead</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">      }</span></span>
<span class="line"><span style="color:#ECEFF4">    ],</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">type</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">illegal_argument_exception</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">reason</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">cannot create index with name [my-data-stream], because it matches with template [my-index-template] that creates data streams only, use create data stream api instead</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">  },</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">status</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 400</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h3 id="ingesting-data-into-data-stream">Ingesting Data into Data stream</h3>
<p>A data stream is append-only. You can only write data to the new index that the Data stream is pointing to. <code>create</code> is only <code>op_type</code> supported.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">POST my-data-stream/_doc </span></span>
<span class="line"><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">@timestamp</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2021-05-17T11:04:05.000Z</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravindputrevu</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">message</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">created new record in new data stream</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<p>The below response shows the index name to which the data is indexed.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_index</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">.ds-my-data-stream-2021.04.03-000001</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_type</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">_doc</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_id</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">ibaqlngBBRKAWM-s4QBK</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_version</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">result</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">created</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_shards</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">total</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 2</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">successful</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 2</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">failed</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 0</span></span>
<span class="line"><span style="color:#ECEFF4">  },</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_seq_no</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 0</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_primary_term</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h3 id="searchingquerying-a-data-stream">Searching/Querying a Data stream</h3>
<p>While querying a Data stream, you query all the hidden indices backing it. Of course, you could manage the indices using an Index Lifecycle Management Policy.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">GET my-data-stream/_search</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">took</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 278</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">timed_out</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#81A1C1"> false</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_shards</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">total</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">successful</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">skipped</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 0</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">failed</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 0</span></span>
<span class="line"><span style="color:#ECEFF4">  },</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">hits</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">total</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">value</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">relation</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">eq</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">    },</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">max_score</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1.0</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">hits</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> [</span></span>
<span class="line"><span style="color:#ECEFF4">      {</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">_index</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">.ds-my-data-stream-2021.04.03-000001</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">_type</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">_doc</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">_id</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">ibaqlngBBRKAWM-s4QBK</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">_score</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1.0</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">_source</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">@timestamp</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2021-05-17T11:04:05.000Z</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravindputrevu</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">          "</span><span style="color:#8FBCBB">message</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">created new record in new data stream</span><span style="color:#ECEFF4">"</span></span>
<span class="line"><span style="color:#ECEFF4">        }</span></span>
<span class="line"><span style="color:#ECEFF4">      }</span></span>
<span class="line"><span style="color:#ECEFF4">    ]</span></span>
<span class="line"><span style="color:#ECEFF4">  }</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h3 id="rolling-over-to-a-new-index">Rolling over to a new index</h3>
<p>Rollover API lets you manually roll over the Data stream to a new write index.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">POST my-data-stream/_rollover</span></span>
<span class="line"></span></code></pre>
<p>Let us ingest a new document to see which index it will be indexed.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">POST my-data-stream/_doc </span></span>
<span class="line"><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">@timestamp</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">2021-05-17T11:04:05.000Z</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravind</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">message</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">created new record in new index</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_index</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">.ds-my-data-stream-2021.04.03-000002</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_type</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">_doc</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_id</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">eXjBlngBMEZuBoEtxmk2</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_version</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">result</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">created</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_shards</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#ECEFF4"> {</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">total</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 2</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">successful</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 2</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">    "</span><span style="color:#8FBCBB">failed</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 0</span></span>
<span class="line"><span style="color:#ECEFF4">  },</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_seq_no</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 0</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">_primary_term</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4"> :</span><span style="color:#B48EAD"> 1</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h3 id="data-stream-naming-convention">Data stream naming convention</h3>
<p>For clear identification, Elastic recommends using a Data stream naming convention, which helps us to identify the dataset, datatype, and data source.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">&#x3C;type>-&#x3C;dataset>-&#x3C;namespace></span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>For example: if we are ingesting Redis server logs from a production deployment. To create a Data stream, according to the convention, it looks like below.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">PUT _data_stream/metrics-redis-server-production</span></span>
<span class="line"></span></code></pre>
<p>Elastic agent ships logs, metrics from various data sources (aka integrations) in a similar Data stream naming convention.</p>
<p>Note: Elasticsearch ships by default with default index templates that match patterns logs-<em>-</em>, metrics-<em>-</em>, and synthetics-<em>-</em>.</p>
<h3 id="updatedelete-data-in-a-data-stream">Update/Delete data in a Data stream</h3>
<p>You can only update the data in a Data stream backed indices via <code>_update_by_query</code>  or  <code>_delete_by_query</code> API.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">POST my-data-stream/_update_by_query </span></span>
<span class="line"><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">  "</span><span style="color:#8FBCBB">query</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">match</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:{</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">        "</span><span style="color:#8FBCBB">username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravindputrevu</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">        }</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">      },</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">      "</span><span style="color:#8FBCBB">script</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">       "</span><span style="color:#8FBCBB">source</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">ctx._source.username = params.new_username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">         "</span><span style="color:#8FBCBB">params</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> {</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">           "</span><span style="color:#8FBCBB">new_username</span><span style="color:#ECEFF4">"</span><span style="color:#ECEFF4">:</span><span style="color:#ECEFF4"> "</span><span style="color:#A3BE8C">aravind</span><span style="color:#ECEFF4">"</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">          }</span></span>
<span class="line"><span style="color:#ECEFF4">        }</span><span style="color:#D8DEE9FF"> </span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre>
<h3 id="statistics-from-a-data-stream">Statistics from a Data stream</h3>
<p><code>_stats</code> endpoint offers an incredible amount of insight into what‚Äôs happening inside an Elasticsearch Data stream or each of its backing indices. You can find out details like the number of open search contexts, query cache size, etc.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">GET _data_stream/my-data-stream/_stats/</span></span>
<span class="line"></span></code></pre>
<h3 id="delete-a-data-stream">Delete a Data stream</h3>
<p>Deleting a Data stream will delete all the hidden backing indices.</p>
<pre class="astro-code nord" style="background-color:#2e3440ff;color:#d8dee9ff; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#D8DEE9FF">DELETE _data_stream/my-data-stream</span></span>
<span class="line"></span></code></pre>
<p>In a crux, Data streams are the new indexing strategy for ingesting logs, metrics, synthetics data into Elasticsearch. It still offers many benefits like granular data control, reduced number of fields per index, which we did not discuss in this article.</p>
<p>Have questions about Elasticsearch or Data streams? You could reach out to me on <a href="https://twitter.com/aravindputrevu">Twitter</a> or <a href="https://linkediin.com/in/aravindputrevu">Linkedin</a>, happy to help!</p> </div> </article>  </main> <footer class="site-footer" data-astro-cid-lejjx2fa> <div class="footer-inner" data-astro-cid-lejjx2fa> <nav class="footer-nav" data-astro-cid-lejjx2fa> <a href="https://linkedin.com/in/aravindputrevu" target="_blank" rel="noopener noreferrer" data-astro-cid-lejjx2fa>LinkedIn</a> <a href="https://aravindputrevu.substack.com" target="_blank" rel="noopener noreferrer" data-astro-cid-lejjx2fa>Substack</a> <a href="https://github.com/aravindputrevu" target="_blank" rel="noopener noreferrer" data-astro-cid-lejjx2fa>GitHub</a> <a href="/archive" data-astro-cid-lejjx2fa>Archive</a> </nav> <span class="updated" data-astro-cid-lejjx2fa>Last updated January 2026</span> </div> </footer>   </body> </html> 